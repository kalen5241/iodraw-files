```mermaid
flowchart TD
    A[main()] --> B{load_traverse_state()}
    B -- 有状态 --> C[reinitialize_driver()]
    B -- 无状态 --> D[load_page_library()]
    C --> E[asyncio.create_task(keep_driver_alive)]
    D --> F[初始化 mcp_context]
    F --> G[webdriver.Remote]
    G --> H[asyncio.create_task(keep_driver_alive)]
    E --> I[traverse_page]
    H --> I
    I --> J{current_depth >= max_depth?}
    J -- 是 --> K[return]
    J -- 否 --> L[获取当前页面信息]
    L --> M{page_id in visited_pages?}
    M -- 是 --> K
    M -- 否 --> N[save_traverse_state]
    N --> O{页面库有触发条件?}
    O -- 有 --> P[execute_prerequisites]
    O -- 无 --> Q[handle_user_input]
    Q -- 无输入 --> K
    Q -- 有输入 --> R[收集页面元素]
    P --> R
    R --> S[更新页面库和MCP上下文]
    S --> T[遍历可交互元素]
    T --> U[driver.find_element().click()]
    U --> V[await traverse_page(递归)]
    V --> W[driver.back()]
    T --> X{异常?}
    X -- 是 --> Y[logger.warning]
    X -- 否 --> T
    R --> Z{WebDriverException?}
    Z -- 是 --> AA[check_driver]
    AA -- 失效 --> AB[reinitialize_driver]
    AB --> AC[await traverse_page(递归)]
    Z -- 否 --> T

```